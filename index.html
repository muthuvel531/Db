<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sound Decibel Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
      background: #f0f4f8;
    }
    #start-btn {
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 8px;
    }
    #start-btn:hover {
      background: #0056b3;
    }
    #decibel-display, #result-display {
      margin-top: 30px;
      font-size: 28px;
      font-weight: bold;
      color: #333;
    }
    #result-display {
      color: green;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¤ Shout Out Loud Game</h1>
  <p>Click the button and shout! The game records your loudest shout in 5 seconds ðŸš€</p>
  <button id="start-btn">Start Measuring</button>
  <div id="decibel-display">Waiting...</div>
  <div id="result-display"></div>

  <script>
    let isMeasuring = false;

    document.getElementById('start-btn').addEventListener('click', () => {
      if (isMeasuring) return; // Prevent multiple clicks
      isMeasuring = true;

      document.getElementById('decibel-display').innerText = "Listening...";
      document.getElementById('result-display').innerText = "";

      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(function(stream) {
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          const analyser = audioContext.createAnalyser();
          const microphone = audioContext.createMediaStreamSource(stream);

          microphone.connect(analyser);

          analyser.fftSize = 2048;
          const bufferLength = analyser.frequencyBinCount;
          const dataArray = new Uint8Array(bufferLength);

          let highestDecibel = -Infinity;
          const startTime = Date.now();

          function measure() {
            analyser.getByteFrequencyData(dataArray);

            let sumSquares = 0;
            for (let i = 0; i < bufferLength; i++) {
              sumSquares += dataArray[i] * dataArray[i];
            }
            const rms = Math.sqrt(sumSquares / bufferLength);
            const decibels = 20 * Math.log10(rms);

            if (isFinite(decibels)) {
              document.getElementById('decibel-display').innerText = decibels.toFixed(2) + " dB";
              if (decibels > highestDecibel) {
                highestDecibel = decibels;
              }
            } else {
              document.getElementById('decibel-display').innerText = "Silent...";
            }

            if (Date.now() - startTime < 5000) {
              requestAnimationFrame(measure);
            } else {
              document.getElementById('result-display').innerText =
                "ðŸŽ‰ Highest Decibel in 5 sec: " + highestDecibel.toFixed(2) + " dB";
              isMeasuring = false;
              stream.getTracks().forEach(track => track.stop()); // Stop mic
            }
          }

          measure();
        })
        .catch(function(err) {
          console.error('Error accessing microphone:', err);
          document.getElementById('decibel-display').innerText = "Microphone access denied!";
          isMeasuring = false;
        });
    });
  </script>
</body>
</html>
